!function(){var navButton=document.querySelector(".menu-toggle");mainNav=document.querySelector(".main-nav"),mainNavClose=document.querySelector(".main-nav__close"),navButton.addEventListener("click",function(event){event.preventDefault(),mainNav.classList.toggle("main-nav--open")}),mainNavClose.addEventListener("click",function(event){event.preventDefault(),mainNav.classList.toggle("main-nav--open")})}(),function(){function request(data,fn){var xhr=new XMLHttpRequest,time=(new Date).getTime();xhr.open("post","http://simonenko.su/academy/echo?"+time),xhr.addEventListener("readystatechange",function(){4==xhr.readyState&&200==xhr.status&&(fn(xhr.responseText),popUpSuccess.classList.add("pop-up--open"))}),xhr.send(data)}function preview(file){if(file.type.match(/image.*/)){var reader=new FileReader;reader.addEventListener("load",function(event){var html=Mustache.render(template,{image:event.target.result,name:file.name}),figure=document.createElement("figure");figure.classList.add("preview"),figure.innerHTML=html,area.appendChild(figure),figure.querySelector(".preview__delete").addEventListener("click",function(event){event.preventDefault(),removePreview(figure)}),queue.push({file:file,figure:figure})}),reader.readAsDataURL(file)}}function removePreview(figure){queue=queue.filter(function(element){return element.figure!=figure}),figure.parentNode.removeChild(figure)}if("FormData"in window||"FileReader"in window){var form=document.querySelector("#form"),area=document.querySelector(".preview-container"),template=document.querySelector("#preview-template").innerHTML,queue=[],popUpError=document.querySelector(".pop-up--error"),popUpSuccess=document.querySelector(".pop-up--success"),popUpClose=document.querySelector(".pop-up__btn--close"),popUpOk=document.querySelector(".pop-up__btn--ok");popUpClose.addEventListener("click",function(event){popUpSuccess.classList.remove("pop-up--open")}),popUpOk.addEventListener("click",function(event){popUpError.classList.remove("pop-up--open")}),form.querySelector("#upload-photo").addEventListener("change",function(){for(var files=this.files,i=0;i<files.length;i++)preview(files[i]);this.value=""}),form.addEventListener("submit",function(event){event.preventDefault();var data=new FormData(form);queue.forEach(function(element){data.append("images",element.file)});for(var requiredInputs=document.querySelectorAll(":required"),i=0;i<requiredInputs.length;i++)if(!requiredInputs[i].value)return void popUpError.classList.add("pop-up--open");request(data,function(response){console.log(response)})})}}(),function(){function dateToString(temp){return("0"+temp.getDate()).slice(-2)+"-"+("0"+Number(temp.getMonth()+1)).slice(-2)+"-"+temp.getFullYear()}function changeValue(input,operation){isNaN(input.value)&&(input.value=0),operation?input.value++:(input.value--,input.value<0&&(input.value=0))}function addPerson(){var html=Mustache.render(template,{id:companionsNumber.value}),person=document.createElement("div");person.classList.add("table__person"),person.innerHTML=html,area.appendChild(person)}function removePerson(){var tempArray=area.querySelectorAll(".table__person");0!=tempArray.length&&tempArray[tempArray.length-1].parentNode.removeChild(tempArray[tempArray.length-1])}var arrivalDate=new Date,departureDate=new Date,arrival=document.querySelector("#arrival-date");arrival.value=dateToString(arrivalDate);var duration=document.querySelector("#duration-days"),departure=document.querySelector("#departure-date");departureDate.setDate(departureDate.getDate()+Number(duration.value)-1),departure.value=dateToString(departureDate),arrival.addEventListener("change",function(event){var dateArray=arrival.value.split("-"),tempDate=new Date(dateArray[2],dateArray[1]-1,Number(dateArray[0]));isNaN(tempDate.getTime())?(arrival.value="дд-мм-гггг",departure.value="дд-мм-гггг"):(arrivalDate=new Date(tempDate),departureDate=new Date(tempDate),departureDate.setDate(departureDate.getDate()+Number(duration.value)-1),departure.value=dateToString(departureDate))});var plusDay=document.querySelector("#days-plus"),minusDay=document.querySelector("#days-minus"),durationDays=document.querySelector("#duration-days");plusDay.addEventListener("click",function(event){changeValue(durationDays,!0),departureDate.setDate(departureDate.getDate()+Number(1)),departure.value=dateToString(departureDate)}),minusDay.addEventListener("click",function(event){durationDays.value>1&&(changeValue(durationDays,!1),departureDate.setDate(departureDate.getDate()-1),departure.value=dateToString(departureDate))}),durationDays.addEventListener("change",function(event){var value=parseInt(durationDays.value);isNaN(value)?durationDays.value=1:(durationDays.value=value,departureDate=new Date(arrivalDate),departureDate.setDate(departureDate.getDate()+Number(value)-1),departure.value=dateToString(departureDate))});var addCompanion=document.querySelector("#companion-plus"),removeCompanion=document.querySelector("#companion-minus"),companionsNumber=document.querySelector("#companions-number"),area=document.querySelector("#table-companions"),template=document.querySelector("#person-template").innerHTML;addCompanion.addEventListener("click",function(event){changeValue(companionsNumber,!0),addPerson()}),removeCompanion.addEventListener("click",function(event){changeValue(companionsNumber,!1),removePerson()})}();